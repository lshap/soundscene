<html>
	<head>
		<script src="js/jquery-1.11.0.min.js"></script>
		<style>	
			.marker {
				position:absolute;
				width:10px;
				height:10px;
				border-radius:10px;
				border:2px solid black;
			}
	
			#canvas {

				position:fixed;
				top:0px;
				left:0px;
			}
		</style>
		<script type="text/javascript">
			var markers = [];
			var canvas;
			var ctxt;
			var width = 200;
			var height = 200;
			var startX = 100;
			var startY = 100;
			var markerRad = 10;
			var selectedmark = -1;
			var mdx;
			var mdy;

			function markerIndex(x, y) {
				var index = -1;
				for (var i = 0; i < markers.length; i++) {
					var marker = markers[i];
					var px = marker.x;
					var py = marker.y;	
					var check = Math.pow(x - px, 2) + Math.pow(y - py, 2);
					if (check < Math.pow(markerRad, 2)) {
						index = i;
						break;
					}	
				}

				return index;
			}

			function drawMarkers(){ 
				ctxt.clearRect(0, 0, width, height); 
				ctxt.drawImage(colorwheel,startX, startY, width, height);			

				for(var i = 0; i < markers.length; i++) {
					ctxt.beginPath();
					var marker = markers[i];
					ctxt.strokeStyle = "#FFFFFF";
					ctxt.lineWidth = 3;
					var px = marker.x;
					var py = marker.y;
				
					var imgData = ctxt.getImageData(px, py, 1, 1).data;
					var r = imgData[0];					
					var g = imgData[1];					
					var b = imgData[2];					
					var a = imgData[3];

					ctxt.fillStyle = "rgba( " + r + " , " +  g + " , " +  b + " , " + a + " )";
					ctxt.arc(px, py, markerRad, 0, Math.PI * 2);	
					ctxt.stroke();
					ctxt.fill();
				}
			}

			$(document).ready(function(){
				for (var i = 0; i < 3; i++) {
					var x = startX + width/2 + 90 * Math.cos(Math.PI/6 * i);
					var y = startX + width/2 + 90 * Math.sin(Math.PI/6 * i);

					var next = {x:x, y:y};
					markers[i] = next;	
				}

				canvas = document.getElementById("canvas");
				console.log(canvas);


				canvas.width = 500;
				canvas.height = 500; 
				ctxt = canvas.getContext("2d");
				ctxt.strokeStyle = "#000000";

				$("#colorwheel").hide();	
				var colorwheel = document.getElementById("colorwheel");
				colorwheel.onload = function() {
					drawMarkers();
				}

				$("#canvas").mousedown(function(ev) {
					var x = ev.pageX;
					var y = ev.pageY;
					var ax = x - (startX + width/2);
					var ay = y - (startY + width/2);

					/*console.log("x = " + x);
					console.log("y = " + y);
					console.log("ax = " + ax);
					console.log("ay = " + ay);*/

					selectedmark = markerIndex(x, y);
				});

				$("#canvas").mouseup(function(ev) {
					selectedmark = -1;
				});
				

				$("#canvas").mousemove(function(ev) {
					if (selectedmark != -1) {
						var marker = markers[selectedmark];
						
						var ux = ev.pageX;
						var uy = ev.pageY;	
						var boundscheck = Math.pow(ux - (startX + width/2), 2) + Math.pow(uy - (startY + width/2),2);

						if (boundscheck < Math.pow(width/2 - markerRad,2)) {
							marker.x = ev.pageX;
							marker.y = ev.pageY;
						} 
						
						else {
							var radius = width/2 - markerRad;
							var ax = ux - (startX + width/2);
							var ay = uy - (startY + width/2);
							var currRadius = Math.sqrt(Math.pow(ax, 2) + Math.pow(ay, 2));
										  

							marker.x = startX + width/2 + radius * ax/currRadius;
							marker.y = startY + width/2 + radius * ay/currRadius;

						}
					}

					drawMarkers();
				});

			});
		</script>
	</head>
	<body>
		<canvas id = "canvas" ondragover="allowDrop(event)" ondrop="onDrop(event)"> </canvas>
		<img src="images/colorwheel.png" id="colorwheel"></img>
	</body>
</html>

