<!DOCTYPE HTML>
<html>
	<head>

		<script type="text/javascript" src="js/dsp.js"></script>
		<script src="js/jquery-1.11.0.min.js"></script>
		<script type="text/javascript">
			var audioContext;
			var audioSource;
			var freqDomain;
			var timeDomain;

			$(document).ready(function() {
				init();

				function init() {
					try {
						// Fix up for prefixing
						window.AudioContext = window.AudioContext
								      ||window.webkitAudioContext;
						 audioContext = new AudioContext();
					}
					 catch(e) {
						alert('Web Audio API is not supported in this browser');
					}
					$("#soundIn").change(loadSound);	
				}				
				
				// load sound from input mp3
				function loadSound() {
					var file = $("#soundIn").get(0).files[0];
					var reader = new FileReader();
					reader.onload = function(e) {
						var buff = e.target.result;
						playSound(buff);
					}				
					
					reader.readAsArrayBuffer(file);
				}

				// analyze qualities of the sound
				function analyzeSound() {
					// set up the AudioAnalserNode
					var analyser = audioContext.createAnalyser();
					audioSource.connect(analyser);
					
					// get the frequency domain
					freqDomain = new Float32Array(analyser.frequencyBinCount);
					analyser.getFloatFrequencyData(freqDomain);
				}
				
				// gets the value of the inputted frequency
				function getFrequencyValue(frequency) {
					var nyquist = audioContext.sampleRate/2;
					var index = Math.round(frequency/nyquist * freqDomain.length);
					return freqDomain[index];
				}
		
				// play sound from ArrayBuffer
				function playSound(buffer) {
					audioSource = audioContext.createBufferSource();
					audioSource.buffer = audioContext.createBuffer(buffer,false);
					audioSource.connect(audioContext.destination);
			
					analyzeSound();
					audioSource.start(0);
				}
			});

		
		</script>
	</head>
	<body>
		<div id="titlediv">
			SOUND SCENE
		</div>
		<div id="inputdiv">
			<input type="file" id="soundIn" accept="audio/*"></input>
		</div>	
	</body>
</html>
